<div class="d-flex min-vh-100">
    <%- include("../../partials/sidebar") %>
  
    <div class="flex-grow-1 d-flex justify-content-center align-items-start px-3 mt-4">
      <div class="w-100" style="max-width: 700px;">
        <div class="card border-warning shadow-sm p-4 bg-light rounded form-bg">
          <h2 class="text-center mb-4">Edit Client</h2>
  
          <% if (errors && errors.length > 0) { %>
            <div class="alert alert-danger">
              <ul class="mb-0">
                <% errors.forEach(err => { %>
                  <li><%= err.msg %></li>
                <% }) %>
              </ul>
            </div>
          <% } %>
  
          <form method="POST" action="/clients/update/<%= oldData.client_id %>">
  
            <!-- Client Info -->
            <h4 class="mt-4 border-bottom pb-2">Client Info</h4>
  
            <div class="mb-3">
              <label for="first_name" class="form-label">First Name</label>
              <input type="text" name="first_name" id="first_name"
                class="form-control <%= errors.find(e => e.param === 'first_name') ? 'is-invalid' : '' %>"
                value="<%= oldData.first_name || '' %>">
              <% const err1 = errors.find(e => e.param === 'first_name'); if (err1) { %>
                <div class="invalid-feedback"><%= err1.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="last_name" class="form-label">Last Name</label>
              <input type="text" name="last_name" id="last_name"
                class="form-control <%= errors.find(e => e.param === 'last_name') ? 'is-invalid' : '' %>"
                value="<%= oldData.last_name || '' %>">
              <% const err2 = errors.find(e => e.param === 'last_name'); if (err2) { %>
                <div class="invalid-feedback"><%= err2.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="phone_number" class="form-label">Phone Number</label>
              <input type="tel" name="phone_number" id="phone_number"
                class="form-control <%= errors.find(e => e.param === 'phone_number') ? 'is-invalid' : '' %>"
                value="<%= oldData.phone_number || '' %>">
              <% const err3 = errors.find(e => e.param === 'phone_number'); if (err3) { %>
                <div class="invalid-feedback"><%= err3.msg %></div>
              <% } %>
            </div>
  
            <!-- Address -->
            <h4 class="mt-4 border-bottom pb-2">Address</h4>
  
            <div class="mb-3">
              <label for="street" class="form-label">Street</label>
              <input type="text" name="street" id="street"
                class="form-control <%= errors.find(e => e.param === 'street') ? 'is-invalid' : '' %>"
                value="<%= oldData.street || '' %>" required>
              <% const streetErr = errors.find(e => e.param === 'street'); if (streetErr) { %>
                <div class="invalid-feedback"><%= streetErr.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="city" class="form-label">City</label>
              <input type="text" name="city" id="city"
                class="form-control <%= errors.find(e => e.param === 'city') ? 'is-invalid' : '' %>"
                value="<%= oldData.city || '' %>" required>
              <% const cityErr = errors.find(e => e.param === 'city'); if (cityErr) { %>
                <div class="invalid-feedback"><%= cityErr.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="zip" class="form-label">ZIP Code</label>
              <input type="text" name="zip" id="zip"
                class="form-control <%= errors.find(e => e.param === 'zip') ? 'is-invalid' : '' %>"
                value="<%= oldData.zip || '' %>" required>
              <% const zipErr = errors.find(e => e.param === 'zip'); if (zipErr) { %>
                <div class="invalid-feedback"><%= zipErr.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="garage_code" class="form-label">Garage Code (if any)</label>
              <input type="text" name="garage_code" id="garage_code" class="form-control" value="<%= oldData.garage_code || '' %>">
            </div>
  
            <!-- Service Details -->
            <h4 class="mt-4 border-bottom pb-2">Service Details</h4>
  
            <div class="mb-3">
              <label for="hired_date" class="form-label">Hired Date</label>
              <input type="date" name="hired_date" id="hired_date"
                class="form-control <%= errors.find(e => e.param === 'hired_date') ? 'is-invalid' : '' %>"
                value="<%= oldData.hired_date || '' %>">
              <% const err4 = errors.find(e => e.param === 'hired_date'); if (err4) { %>
                <div class="invalid-feedback"><%= err4.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="service_hours" class="form-label">Service Hours</label>
              <input type="number" step="0.25" name="service_hours" id="service_hours"
                class="form-control <%= errors.find(e => e.param === 'service_hours') ? 'is-invalid' : '' %>"
                value="<%= oldData.service_hours || '' %>">
              <% const err5 = errors.find(e => e.param === 'service_hours'); if (err5) { %>
                <div class="invalid-feedback"><%= err5.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="preferred_day" class="form-label">Preferred Day</label>
              <select name="preferred_day" id="preferred_day"
                class="form-select <%= errors.find(e => e.param === 'preferred_day') ? 'is-invalid' : '' %>">
                <option value="M" <%= oldData.preferred_day==='M' ? 'selected' : '' %>>Monday</option>
                <option value="TUE" <%= oldData.preferred_day==='TUE' ? 'selected' : '' %>>Tuesday</option>
                <option value="W" <%= oldData.preferred_day==='W' ? 'selected' : '' %>>Wednesday</option>
                <option value="TH" <%= oldData.preferred_day==='TH' ? 'selected' : '' %>>Thursday</option>
                <option value="F" <%= oldData.preferred_day==='F' ? 'selected' : '' %>>Friday</option>
                <option value="NOTSET" <%= oldData.preferred_day==='NOTSET' ? 'selected' : '' %>>Not Set</option>
              </select>
              <% const err6 = errors.find(e => e.param === 'preferred_day'); if (err6) { %>
                <div class="invalid-feedback"><%= err6.msg %></div>
              <% } %>
            </div>
  
            <div class="mb-3">
              <label for="service_type_id" class="form-label">Service Type</label>
              <select name="service_type_id" id="service_type_id"
                class="form-control <%= errors.find(e => e.param === 'service_type_id') ? 'is-invalid' : '' %>">
                <option value="">-- Select a service type --</option>
                <% serviceTypes.forEach(type => { %>
                  <option value="<%= type.service_id %>" <%= oldData.service_type_id == type.service_id ? 'selected' : '' %>>
                    <%= type.service_frequency %>
                  </option>
                <% }) %>
              </select>
              <% const typeErr = errors.find(e => e.param === 'service_type_id'); if (typeErr) { %>
                <div class="invalid-feedback"><%= typeErr.msg %></div>
              <% } %>
            </div>
            
            <!-- Extra Client Info -->
            <h4 class="mt-4 border-bottom pb-2">Extra Client Info</h4>            
            <div class="mb-3">
              <label for="price" class="form-label">Service Price</label>
              <input type="number" step="0.01" name="price" id="price"
                class="form-control <%= errors.find(e => e.param === 'price') ? 'is-invalid' : '' %>"
                value="<%= oldData.price || '' %>">
              <% const priceErr = errors.find(e => e.param === 'price'); if (priceErr) { %>
                <div class="invalid-feedback"><%= priceErr.msg %></div>
              <% } %>
            </div>
            
            <div class="mb-3">
              <label for="full_house" class="form-label">Full or Half House</label>
              <select name="full_house" id="full_house" class="form-select">
                <option value="true" <%=oldData.full_house===true ||
                  oldData.full_house==="true" ? "selected" : "" %>>Full</option>
                <option value="false" <%=oldData.full_house===false ||
                  oldData.full_house==="false" ? "selected" : "" %>>Half</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="notes" class="form-label">Notes</label>
              <textarea class="form-control" id="notes" name="notes">
                <%= oldData?.notes || '' %>
              </textarea>
            </div>
            
            <div class="mb-3">
              <label for="is_active_new" class="form-label">Status</label>
              <select class="form-select <%= errors.find(e => e.param === 'is_active_new') ? 'is-invalid' : '' %>" 
                      id="is_active_new" name="is_active_new">
                <option value="true" <%= oldData?.is_active_new == 'true' ? 'selected' : '' %>>Active</option>
                <option value="false" <%= oldData?.is_active_new == 'false' ? 'selected' : '' %>>Inactive</option>
              </select>
              <% const statusErr = errors.find(e => e.param === 'is_active_new'); if (statusErr) { %>
                <div class="invalid-feedback"><%= statusErr.msg %></div>
              <% } %>
            </div>                                    

            <button type="submit" class="btn btn-warning w-100 mt-3">Update Client</button>
          </form>
          <div class="mt-3">
            <a href="/dashboard" class="btn btn-outline-secondary btn-block">← Back to
              Dashboard</a>
          </div>
        </div>
      </div>
    </div>
  </div>
